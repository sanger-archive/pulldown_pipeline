<%= page(:search) do %>
  <div data-role="header">
    <h1>Sequencescape - Pulldown Pipeline</h1>
    <%= link_to "All Plates", all_outstanding_plates_path, :rel => 'external' %>
  </div>

  <%= content do %>
    <%= flash_messages %>

      <h1>Search for Plate</h1>
        <%= section do %>
          <%= form_tag perform_search_path, :id => "plate-search-form", :method => 'post' do %>
            <p>
            <%= label_tag :card_id, "User Swipecard" %>
            <%= text_field_tag :card_id, params[:card_id] %>
            </p>
            <p>
            <%= label_tag :plate_barcode, "Plate Barcode" %>
            <%= text_field_tag :plate_barcode, params[:plate_barcode] %>
            </p>

            <%= submit_tag "Show Plate",
              :name           => nil,
              :'data-theme'   => "b",
              :class          => "submit",
              :'data-inline'  => "true",
              :'data-icon'    => "arrow-r",
              :'data-iconpos' => "right"
            %>
          <% end %>
        <% end %>

        <% unless @ongoing.empty? %>
          <%= section do %>
            <%= render(:partial => 'plate_progress', :locals => { :plates => @ongoing }) %>
          <% end %>
        <% end %>

  <% end %>
<% end %>


<script type="text/javascript">
  $(function(){
    // Users should start the page by scanning in...
    $('#card_id').focus();


    $('#card_id').change(function(){
      if ($(this).val()) {
        $('.ui-header').removeClass('ui-bar-a').addClass('ui-bar-b');
      } else {
        $('.ui-header').removeClass('ui-bar-b').addClass('ui-bar-a');
      }
    });

    // Trap the carriage return sent by the swipecard reader
    $("#card_id").bind("keydown", function(e) {
      var code=e.charCode || e.keyCode;
      if (code==13) {
        $("#plate_barcode").focus();
        return false;
      }
    });

    // Fill in the plate barcode with the plate links barcode
    $(".plate_link").click(function() {
      $('#plate_barcode').val($(this).attr('id').substr(6));
      $('#plate-search-form').submit();
      return false;
    });


  });
</script>

