<%= page(:creation) do -%>
  <%= header(@creation_form, 'Choose tag layout') %>

  <%= content do %>
    <%= semantic_form_for(@creation_form, :as => :plate, :url => pulldown_plate_children_path(@creation_form.parent), :html => {:method => :post}) do |f| %>
      <%= f.inputs do %>
        <%= f.input :plate_purpose_uuid, :as => :hidden, :value =>@creation_form.plate_purpose_uuid %>
        <%= f.input :parent_uuid, :as => :hidden, :value => @creation_form.parent_uuid %>
        <%= f.input :tag_layout_template_uuid, :label => "Tag Template", :as => :select, :collection => @creation_form.tag_layout_templates, :include_blank => false %>
      <%- end -%>
      <%= f.buttons do %>
        <%= f.commit_button 'Create Plate' %>
      <%- end -%>
    <%- end -%>

<script type="text/javascript" charset="utf-8">
  $(function(){
    $('.aliquot').removeClass('green orange red');

    var tag_layouts = <%= @creation_form.tag_groups.to_json.html_safe %>


    function update_layout() {
      var tags = tag_layouts[$('#plate_tag_layout_template_uuid option:selected').text()];

      $('.aliquot').each(function(index){
        var tag_id = tags[index];

        $(this).
          hide().
          text(tag_id).
          removeClass().
          addClass('aliquot colour-' + ( tag_id % 96 + 1) ).
          fadeIn();
      });
    }

    update_layout();
    $('#plate_tag_layout_template_uuid').change(update_layout);

  });
</script>
    <%= render :partial => 'plates/plate', :locals => { :plate_presenter => @creation_form } %>
  <%- end -%>
<%- end -%>
